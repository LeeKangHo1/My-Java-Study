## 1. preparedStatement 객체의 excuteBatch
- 이클립스에서 db table에 여러 행을 넣는 메서드에서 활용
- ![](트랜잭션%20제어하면서%20다중%20행%20집어넣기.jpg)
	- List<\Product> list
		- 다중 행 내용이 담긴 리스트
	- 트랜잭션 제어
		- All or Nothing전략: 모든 명령어가 제대로 실행되면 실행. 하나라도 오류있으면 모든 실행된 명령이 취소되게 한다.
		- 트랜잭션 제어가 없을 경우 여러 행 삽입 시 table에 맞는 행들은 들어가고 아닌 행은 들어가지 않는다.(예외는 발생)
		- 트랜잭션 제어를 할 경우 행 삽입 과정에서 1번이라도 문제가 생길 시 어떤 행도 삽입되지 않는다.
		- conn.setAutoCommit(false)
			- mysql은 디폴트값이 true이며 false로 변경 시 트랜잭션 제어가 시작된다.
		- conn.commit();
			- 이 명령어 이전까지 내용이 오류(예외) 발생 시 롤백된다.
		- conn.rollback();
			- 커밋 하기 전에 예외 발생 시 했던 작업을 모두 되돌린다.
			- try and catch구문을 적용해야 한다.
	- stmt.executeBatch()
		- stmt.addBatch()로 쿼리 구문을 메모리에 쌓아 두었다가 실행 명령(excuteBatch)이 있으면 한번에 db 쪽으로 쿼리문을 전달한다.
		- 반환값은 배열로 온다.(다중 행 입력 용이니까)

---
## 2. PreparedStatement
- Statement 객체보다 기능 향상
- 코드 안정성, 가독성 높음
- 동적 파라미터 활용 가능
- conn.prepareStatement(sql)
	- String sql = "쿼리문"
		- 쿼리문 마무리 ; 생략해도 된다.
	- String sql = "SELECT * FROM products WHERE price BETWEEN ? AND ?"
		- ?에 세터를 통해 변수 설정 가능
		- stmt.setInt(1, INT)
			- 1번째 ?에 INT값을 넣어준다.
		- stmt.setString(2, String)
			- 2번째 ?에 String값을 넣어준다.
		- 배열이나 리스트와 달리 1번 인덱스가 0이 아니고 1인 것을 주의
			- for구문 작성 시 주의
			- for (int i = 1, i <= List.size(), i++)
	- ResultSet rs = stmt.excuteQuery();
		- excuteQuery() 안에 파라미터를 넣지 않아도 된다.
			- Statement객체의 경우 stmt.excuteQuery(sql); 이렇게 적어야 한다.
		- stmt = conn.prepareStatement(sql);
			- stmt.setInt( );
			- prepareStatement(sql)과 세터로 stmt가 이미 완성 되어 있기 때문
- int rows = stmt.executeUpdate();
	- DML인 INSERT, UPDATE, DELETE로 테이블 row값이 바뀐 후 변경된 행의 개수 반환
- 자동으로 생성된 마지막 pk값을 반환
	1) ![](마지막으로%20생성된%20pk값%20반환1.jpg)
		- conn.prepareStatement(sql, Statement.RETURN_GENERATED_KEYS)
		- rs = stmt.getGeneratedKeys();
	2) ![](마지막으로%20생성된%20pk값%20반환2.jpg)
		- sql 쿼리문 "SELECT LAST_INSERT_ID()"를 활용

---
## 3. StringJoiner
- prepareStatement에서 동적 파라미터 ?를 사용할 때 사용한다.
- ![](StringJoiner.jpg)
	- StringJoiner(구분자, 시작기호, 마지막기호);
		- size가 3일 경우 String s = "(?, ?, ?)"를 반환한다.

---
### 4. Connection 1번만 열어서 여러 번 활용하기
- 메서드 파라미터에 Connection conn을 추가한다.
- ![](컬렉션%20재활용.jpg)
	- subscribeDAO.insertBatch2(allKeys, "구독", conn)
		- insertBatch2 메서드의 헤더는 다음과 같다.
		- public int\[] insertBatch2(List<\Integer> fks, String subscribeType, Connection conn)

---




- #### tips
	- DAO(Data Access Object)
		- db의 data에 접근하기 위한 객체
	- DBUtil.loadDriver();
		- driver 적재는 1번은 실행시켜줘야 한다.
			- 이클립스에서는 예전에 실행시켰으면 바꾸지 않을 경우 유지된다.
	- 